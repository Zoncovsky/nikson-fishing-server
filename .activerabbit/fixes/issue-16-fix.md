# Fix for ActiveRecord::RecordNotFound

**Issue ID:** 16
**Generated:** 2026-01-22 23:59 UTC
**Status:** üìã Suggestion only (manual review required)

## Suggested Code Fix

```ruby
# Before
def set_product
  @product = Product.friendly.find(params[:id])
end

# After
def set_product
  @product = Product.friendly.find(params[:id])
rescue ActiveRecord::RecordNotFound
  flash[:alert] = "Product not found."
  redirect_to products_path
end
```

## Full Analysis

## üêõ Bug Fix: ActiveRecord::RecordNotFound

**Issue ID:** #16
**Controller:** `ProductsController#show`
**Occurrences:** 10 times
**First seen:** 2026-01-13 23:05
**Last seen:** 2026-01-13 23:05

## üîç Root Cause Analysis

The error occurs because the `set_product` method in the `ProductsController` is attempting to find a product using a "friendly id" that does not exist in the database. The friendly id "test-product" cannot be found, leading to an `ActiveRecord::RecordNotFound` exception.

## üîß Suggested Fix

Ensure that the product with the friendly id "test-product" exists in the database. If the product should exist, verify that it has been correctly created and saved with the expected friendly id. Alternatively, handle the case where a product might not be found by providing a user-friendly error message or redirecting to a different page.

Example code change to handle the exception:

```ruby
# Before
def set_product
  @product = Product.friendly.find(params[:id])
end

# After
def set_product
  @product = Product.friendly.find(params[:id])
rescue ActiveRecord::RecordNotFound
  flash[:alert] = "Product not found."
  redirect_to products_path
end
```

## üìã Error Details

**Error Message:**
```
can't find record with friendly id: "test-product"
```

**Stack Trace (top frames):**
```
["app/app/controllers/products_controller.rb:198:in `set_product'", "app/models/company.rb:42:in `find_by_friendly_id'", "app/controllers/application_controller.rb:15:in `set_current_tenant'"]
```

**Request Context:**
- Method: `GET`
- Path: `/product/xylem`

## üõ°Ô∏è Prevention

1. **Validation**: Ensure that all products are created with a valid and unique friendly id.
2. **Error Handling**: Implement error handling for `ActiveRecord::RecordNotFound` to gracefully manage cases where records are not found.
3. **Testing**: Write tests to cover scenarios where records might not exist and ensure the application handles these gracefully.

## ‚úÖ Checklist

- [ ] Code fix implemented
- [ ] Tests added/updated
- [ ] Error scenario manually verified
- [ ] No regressions introduced

---
_Generated by [ActiveRabbit](https://activerabbit.ai) AI_

---
_Generated by [ActiveRabbit](https://activerabbit.ai) AI_